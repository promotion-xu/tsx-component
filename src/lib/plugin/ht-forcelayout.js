!function(a,b,c){"use strict";var d="ht",e=d+".layout.",f=a[d]||module.parent.exports.ht,g=f.List,h=f.DataModel,i=f.Node,j=f.Edge,k=f.Group,l=Math,m=l.sqrt,n=l.random,o=l.max,p=l.min,q=function(a){return a*a};f.Default.getInternal().addMSMap({ms_force:function(a,b){a._interval=50,a._stepCount=10,a._motionLimit=.01,a._edgeRepulsion=.65,a._nodeRepulsion=.65,a._damper=1,a._maxMotion=0,a._motionRatio=0,a.init=function(a){var b=this;a instanceof h?b.dm=a:b.gv=a,b._nodeMap={},b._nodes=new g,b._edges=new g},a.start=function(){var a=this,b=a.gv;if(!a._timer){var c=a.cdm=b?b.dm():a.dm;c.mm(a.handleDataModelChange,a),c.md(a.handleDataPropertyChange,a),b&&b.mp(a.handleGV,a),c.each(function(b){if(a.isVisible(b)&&a.isLayoutable(b)&&b instanceof i)if(a instanceof r){var c=b.p3();b.p3([c[0]+n(),c[1]+n(),c[2]+n()])}else c=b.p(),b.p(c.x+n(),c.y+n())}),a._timer=setInterval(function(){a.relax()},a._interval),a._damper=1}},a.stop=function(){var a=this;a._timer&&(a.cdm.umm(a.handleDataModelChange,a),a.cdm.umd(a.handleDataPropertyChange,a),a.gv&&a.gv.ump(a.handleGV,a),clearInterval(a._timer),delete a._timer,delete a.cdm)},a.handleGV=function(a){var b=this;if("dataModel"===a.property){var c=a.oldValue,d=a.newValue;c&&(c.umm(b.handleDataModelChange,b),c.umd(b.handleDataPropertyChange,b)),this.cdm=d,d.mm(b.handleDataModelChange,b),d.md(b.handleDataPropertyChange,b)}},a.relax=function(){var a=this;if(!(a._damper<.1&&a._maxMotion<a._motionLimit)){this.cdm.each(function(b){a.isVisible(b)&&(b instanceof j?a.addEdge(b):b instanceof i&&a.addNode(b))});for(var b,c,d=0,e=a._edges,f=a._nodes,g=f.size();d<a._stepCount;d++){for(e.each(a.relaxEdge,a),b=0;g>b;b++)for(c=0;g>c;c++)a.relaxNode(f.get(b),f.get(c));a.moveNode()}a._isAdjusting=1,f.each(function(a){a.fix||(a.p?a.v.p3(a.p):a.v.p(a.x,a.y))}),delete a._isAdjusting,a._nodeMap={},f.clear(),e.clear(),a.onRelaxed()}},a.onRelaxed=function(){},a.isRunning=function(){return!!this._timer},a.isVisible=function(a){return a.s("layoutable")===!1?!1:this.gv?this.gv.isVisible(a):!0},a.isLayoutable=function(a){if(a.s("layoutable")===!1)return!1;if(a instanceof k)return!1;var b=this;return b.gv?b.gv.isMovable(a)&&!b.gv.isSelected(a):!(b.cdm||b.dm).sm().co(a)},a.getNodeRepulsion=function(){return this._nodeRepulsion},a.setNodeRepulsion=function(a){this._nodeRepulsion=a,this._damper=1},a.getEdgeRepulsion=function(){return this._edgeRepulsion},a.setEdgeRepulsion=function(a){this._edgeRepulsion=a,this._damper=1},a.getStepCount=function(){return this._stepCount},a.setStepCount=function(a){this._stepCount=a,this._damper=1},a.getInterval=function(){return this._interval},a.setInterval=function(a){var b=this;b._interval!==a&&(b._interval=a,b._timer&&(clearInterval(b._timer),b._timer=setInterval(function(){b.relax()},a)))},a.handleDataPropertyChange=function(a){!this._isAdjusting&&this.isVisible(a.data)&&(this._damper=1)},a.handleDataModelChange=function(a){this._damper=1},a.damp=function(){var a=this._maxMotion,b=this._damper;this._motionRatio<=.001&&((.2>a||a>1&&.9>b)&&b>.01?this._damper-=.01:.4>a&&b>.003?this._damper-=.003:b>1e-4&&(this._damper-=1e-4)),a<this._motionLimit&&(this._damper=0)}}}),f.layout.ForceLayout=function(a){this.init(a)},f.Default.def(e+"ForceLayout",b,{ms_force:1,getLimitBounds:function(){return this._limitBounds},setLimitBounds:function(a){this._limitBounds=a,this._damper=1},getNodeSize:function(a){var b=this.gv;return b&&b.getDataUIBounds?b.getDataUIBounds(a):a.getRect()},addNode:function(a){var b=this,c=b._nodeMap[a._id];if(c)return c;var d=a.p();c={v:a,x:d.x,y:d.y,dx:0,dy:0,fix:!b.isLayoutable(a),s:b.getNodeSize(a)};var e=c.s,f=m(q(e.width)+q(e.height))*b._nodeRepulsion;return c.r=1>f?100:f,b._nodeMap[a._id]=c,b._nodes.add(c),c},addEdge:function(a){if(a._40I&&a._41I){var b=this,c=b.addNode(a._40I),d=b.addNode(a._41I),e={s:c,t:d};d=d.s,c=c.s;var f=d.width+c.width,g=d.height+c.height;e.length=m(f*f+g*g)*b._edgeRepulsion,e.length<=0&&(e.length=100),b._edges.add(e)}},relaxEdge:function(a){var b=a.t,c=a.s,d=b.x-c.x,e=b.y-c.y,f=m(d*d+e*e),g=100*a.length,h=.25*d/g*f,i=.25*e/g*f;b.dx=b.dx-h,b.dy=b.dy-i,c.dx=c.dx+h,c.dy=c.dy+i},relaxNode:function(a,b){if(a!==b){var c=0,d=0,e=a.x-b.x,f=a.y-b.y,g=e*e+f*f;0===g?(c=n(),d=n()):36e4>g&&(c=e/g,d=f/g);var h=a.r*b.r/400;c*=h,d*=h,a.dx+=c,a.dy+=d,b.dx-=c,b.dy-=d}},moveNode:function(){var a=this,b=a._limitBounds,c=a._maxMotion,d=0,e=a._damper;a._nodes.each(function(c){if(!c.fix){var f=c.dx*e,g=c.dy*e;if(c.dx=f/2,c.dy=g/2,d=o(m(f*f+g*g),d),c.x+=o(-40,p(40,f)),c.y+=o(-40,p(40,g)),b){c.x<b.x&&(c.x=b.x,a.adjust(1,0)),c.y<b.y&&(c.y=b.y,a.adjust(0,1));var h=c.s;c.x+h.width>b.x+b.width&&(c.x=b.x+b.width-h.width,a.adjust(-1,0)),c.y+h.height>b.y+b.height&&(c.y=b.y+b.height-h.height,a.adjust(0,-1))}}}),a._maxMotion=d,a._motionRatio=d>0?c/d-1:0,a.damp()},adjust:function(a,b){var c=this._limitBounds;this._nodes.each(function(d){a>0?(!c||d.x+d.s.width+a<c.x+c.width)&&(d.x+=a):(!c||d.x+a>c.x)&&(d.x+=a),b>0?(!c||d.y+d.s.height+b<c.y+c.height)&&(d.y+=b):(!c||d.y+b>c.y)&&(d.y+=b)})}});var r=f.layout.Force3dLayout=function(a){this.init(a)};f.Default.def(e+"Force3dLayout",b,{ms_force:1,getNodeSize3d:function(a){return a.s3()},addNode:function(a){var b=this,c=b._nodeMap[a._id];if(c)return c;c={v:a,p:a.p3(),d:[0,0,0],fix:!b.isLayoutable(a),s:b.getNodeSize3d(a)};var d=c.s,e=f.Default.getDistance(d)*b._nodeRepulsion;return c.r=1>e?100:e,b._nodeMap[a._id]=c,b._nodes.add(c),c},addEdge:function(a){if(a._40I&&a._41I){var b=this,c=b.addNode(a._40I),d=b.addNode(a._41I),e={s:c,t:d};d=d.s,c=c.s,e.length=m(q(d[0]+c[0])+q(d[1]+c[1])+q(d[2]+c[2]))*b._edgeRepulsion,e.length<=0&&(e.length=100),b._edges.add(e)}},relaxEdge:function(a){var b=a.t.p,c=a.s.p,d=a.t.d,e=a.s.d,f=b[0]-c[0],g=b[1]-c[1],h=b[2]-c[2],i=m(f*f+g*g+h*h),j=100*a.length,k=.25*f/j*i,l=.25*g/j*i,n=.25*h/j*i;d[0]-=k,d[1]-=l,d[2]-=n,e[0]+=k,e[1]+=l,e[2]+=n},relaxNode:function(a,b){if(a!==b){var c=a.p,d=b.p,e=0,f=0,g=0,h=c[0]-d[0],i=c[1]-d[1],j=c[2]-d[2],k=h*h+i*i+j*j;0===k?(e=n(),f=n(),g=n()):216e6>k&&(e=h/k,f=i/k,g=j/k);var l=a.r*b.r/400,m=a.d,o=b.d;e*=l,f*=l,g*=l,m[0]+=e,m[1]+=f,m[2]+=g,o[0]-=e,o[1]-=f,o[2]-=g}},moveNode:function(){var a=this,b=a._maxMotion,c=0,d=a._damper;a._nodes.each(function(a){if(!a.fix){var b=a.p,e=a.d,f=e[0]*d,g=e[1]*d,h=e[2]*d;e[0]=f/2,e[1]=g/2,e[2]=h/2,c=o(m(f*f+g*g+h*h),c),b[0]+=o(-40,p(40,f)),b[1]+=o(-40,p(40,g)),b[2]+=o(-40,p(40,h))}}),a._maxMotion=c,a._motionRatio=c>0?b/c-1:0,a.damp()}})}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);