!function(a,b,c){"use strict";var d=a.ht;d.Astar={};!function(b){var c=b();a.AStar=c.astar,a.AStar.Graph=c.Graph}(function(){function a(a){for(var b=a,c=[];b.parent;)c.unshift(b),b=b.parent;return c}function b(){return new e(function(a){return a.f})}function c(a,b){b=b||{},this.nodes=[],this.diagonal=!!b.diagonal,this.grid=[];for(var c=0;c<a.length;c++){this.grid[c]=[];for(var e=0,f=a[c];e<f.length;e++){var g=new d(c,e,f[e]);this.grid[c][e]=g,this.nodes.push(g)}}this.$13x()}function d(a,b,c){this.x=a,this.y=b,this.weight=c}function e(a){this.content=[],this.scoreFunction=a}var f={search:function(c,d,e,g){c.$6x(),g=g||{};var h=g.heuristic;h||(h=c.diagonal?f.$4x.diagonal:f.$4x.manhattan);var i=g.closest||!1,j=g.punish,k=b(),l=d;for(d.h=h(d,e),c.$7x(d),k.push(d);k.size()>0;){var m=k.pop();if(m===e)return a(m);m.closed=!0;for(var n=c.neighbors(m),o=0,p=n.length;p>o;++o){var q=n[o];if(!q.closed&&!q.$9x()){var r=m.g+q.getCost(m,j),s=q.visited;(!s||r<q.g)&&(q.visited=!0,q.parent=m,q.h=q.h||h(q,e),q.g=r,q.f=q.g+q.h,c.$7x(q),i&&(q.h<l.h||q.h===l.h&&q.g<l.g)&&(l=q),s?k.$10x(q):k.push(q))}}}return i?a(l):[]},$4x:{manhattan:function(a,b){var c=Math.abs(b.x-a.x),d=Math.abs(b.y-a.y);return c+d},diagonal:function(a,b){var c=1,d=Math.sqrt(2),e=Math.abs(b.x-a.x),f=Math.abs(b.y-a.y);return c*(e+f)+(d-2*c)*Math.min(e,f)}},$5x:function(a){a.f=0,a.g=0,a.h=0,a.visited=!1,a.closed=!1,a.parent=null}};return c.prototype.$13x=function(){this.dirtyNodes=[];for(var a=0;a<this.nodes.length;a++)f.$5x(this.nodes[a])},c.prototype.$6x=function(){for(var a=0;a<this.dirtyNodes.length;a++)f.$5x(this.dirtyNodes[a]);this.dirtyNodes=[]},c.prototype.$7x=function(a){this.dirtyNodes.push(a)},c.prototype.neighbors=function(a){var b=[],c=a.x,d=a.y,e=this.grid;return e[c-1]&&e[c-1][d]&&b.push(e[c-1][d]),e[c+1]&&e[c+1][d]&&b.push(e[c+1][d]),e[c]&&e[c][d-1]&&b.push(e[c][d-1]),e[c]&&e[c][d+1]&&b.push(e[c][d+1]),this.diagonal&&(e[c-1]&&e[c-1][d-1]&&b.push(e[c-1][d-1]),e[c+1]&&e[c+1][d-1]&&b.push(e[c+1][d-1]),e[c-1]&&e[c-1][d+1]&&b.push(e[c-1][d+1]),e[c+1]&&e[c+1][d+1]&&b.push(e[c+1][d+1])),b},c.prototype.toString=function(){for(var a=[],b=this.grid,c=0;c<b.length;c++){for(var d=[],e=b[c],f=0;f<e.length;f++)d.push(e[f].weight);a.push(d.join(" "))}return a.join("\n")},d.prototype.toString=function(){return"["+this.x+" "+this.y+"]"},d.prototype.getCost=function(a,b){var c;if(c=a&&a.x!=this.x&&a.y!=this.y?1.41421*this.weight:this.weight,b){var d=a;if(!d)return c;var e=d.parent;return e?Math.abs(e.x+this.x-2*d.x)>1e-5?c+b:Math.abs(e.y+this.y-2*d.y)>1e-5?c+b:c:c}},d.prototype.$9x=function(){return 0===this.weight},e.prototype={push:function(a){this.content.push(a),this.$11x(this.content.length-1)},pop:function(){var a=this.content[0],b=this.content.pop();return this.content.length>0&&(this.content[0]=b,this.$12x(0)),a},remove:function(a){var b=this.content.indexOf(a),c=this.content.pop();b!==this.content.length-1&&(this.content[b]=c,this.scoreFunction(c)<this.scoreFunction(a)?this.$11x(b):this.$12x(b))},size:function(){return this.content.length},$10x:function(a){this.$11x(this.content.indexOf(a))},$11x:function(a){for(var b=this.content[a];a>0;){var c=(a+1>>1)-1,d=this.content[c];if(!(this.scoreFunction(b)<this.scoreFunction(d)))break;this.content[c]=b,this.content[a]=d,a=c}},$12x:function(a){for(var b=this.content.length,c=this.content[a],d=this.scoreFunction(c);;){var e,f=a+1<<1,g=f-1,h=null;if(b>g){var i=this.content[g];e=this.scoreFunction(i),d>e&&(h=g)}if(b>f){var j=this.content[f],k=this.scoreFunction(j);(null===h?d:e)>k&&(h=f)}if(null===h)break;this.content[a]=this.content[h],this.content[h]=c,a=h}}},{astar:f,Graph:c}});var e=d.Astar.Finder=function(a,b){var c=this;c.gv=a,c.$13x(b),c.refreshMap()};e.prototype={},e.prototype.constructor=e,b.defineProperties(e.prototype,{_debugInfo:{get:function(){return this.gv._astarDebugInfo},set:function(a){this.gv._astarDebugInfo=a}}}),e.prototype.$13x=function(a){var b=this,d=b.$14x={};a=a||{};var e=a.gridSize||10;d.gridSizeX=a.gridSizeX||e,d.gridSizeY=a.gridSizeY||e,d.rect=a.rect,d.filter=a.filter,d.extendBlocks=a.extendBlocks||3,d.fastOverlap=a.fastOverlap===c?!0:a.fastOverlap,d.nodeRectExtend=a.nodeRectExtend||0,d.diagonal=a.diagonal===c?!0:a.diagonal,d.turnPunish=a.turnPunish===c?.1:a.turnPunish,d.simplify=a.simplify===c?!0:a.simplify,d.toGridCenter=a.toGridCenter===c?!1:a.toGridCenter,d.closest=a.closest===c?!0:a.closest},e.prototype.refreshMap=function(){var a,b=this,c=b.$14x,e=c.gridSizeX,f=c.gridSizeY,g=c.extendBlocks;c.rect?a=c.rect:(a=b.$15x(),d.Default.grow(a,e*g,f*g)),d.Default.grow(a,e,f);var h=Math.floor(a.x/e)*e,i=Math.floor(a.y/f)*f,j=Math.ceil(a.width/e),k=Math.ceil(a.height/f),l=j*e,m=k*f;b.$16x={x:h,y:i,w:l,h:m,gridX:e,gridY:f,xLen:j,yLen:k},b.$17x(),b.$21x()},e.prototype.$15x=function(){var a=this.gv;if(a instanceof d.graph.GraphView)return a.getContentRect();var b,c=d.Default.unionRect;return a.dm().each(function(d){a.isVisible(d)&&d.getRect&&(b=c(b,d.getRect()))}),b},e.prototype.$17x=function(){var a,b,c,d,e=this,f=e.$16x,g=f.xLen,h=f.yLen;for(a=new Array(g),c=0;g>c;c++)for(a[c]=b=new Array(h),d=h;d--;)b[d]=1;var i=e.$14x.filter;for(e.gv.dm().each(function(b){i&&i(b)===!1||(!e._debugInfo||b!==e._debugInfo.grid&&b!=e._debugInfo.path)&&e.$1cw(a,b)}),c=0;g>c;c++)a[c][0]=1,a[c][h-1]=1;for(d=0;h>d;d++)a[0][d]=1,a[g-1][d]=1;e.grid=a;var j=new AStar.Graph(a,{diagonal:e.$14x.diagonal});e.graph=j},e.prototype.$18x=function(a,b,c,d,e,f,g,h){var i=this.$19x,j=i(c-a,e-g,d-b,f-h);if(1e-6>=j&&j>=-1e-6)return!1;var k=i(e-a,e-g,f-b,f-h)/j;if(0>k||k>1)return!1;var l=i(c-a,e-a,d-b,f-b)/j;return 0>l||l>1?!1:!0},e.prototype.$19x=function(a,b,c,d){return a*d-b*c},e.prototype.$1aw=function(a,b,c,d){for(var e=[-(b[1]-a[1]),b[0]-a[0]],f=e[0]*(c[0]-a[0])+e[1]*(c[1]-a[1])>=0,g=0,h=d.length;h>g;g+=2)if(e[0]*(d[g]-a[0])+e[1]*(d[g+1]-a[1])>=0===f)return!1;return!0},e.prototype.$1bw=function(a,b){for(var c,d,e=this,f=0,g=a.length;g>f;f+=2)if(c=f===g-2?0:f+2,d=c===g-2?0:c+2,e.$1aw([a[f],a[f+1]],[a[c],a[c+1]],[a[d],a[d+1]],b))return!1;for(var f=0,g=b.length;g>f;f+=2)if(c=f===g-2?0:f+2,d=c===g-2?0:c+2,e.$1aw([b[f],b[f+1]],[b[c],b[c+1]],[b[d],b[d+1]],a))return!1;return!0},e.prototype.$1cw=function(a,b){if(b.getRect){var c=this,e=b.getRect();d.Default.grow(e,c.$14x.nodeRectExtend);var f,g,h,i,j,k,l,m,n,o,p,q=c.$1dw({x:e.x,y:e.y}),r=c.$1dw({x:e.x+e.width,y:e.y+e.height}),s=c.$14x.fastOverlap;if(!s){var t=b.getCorners();l=[],t.forEach(function(a){l.push(a.x,a.y)}),o=c.$14x.gridSizeX/2,p=c.$14x.gridSizeY/2}for(g=Math.max(0,q.x),h=Math.min(r.x,a.length-1),j=Math.max(0,q.y),k=Math.min(r.y,a.length?a[0].length-1:-1),f=g;h>=f;f++)for(i=j;k>=i;i++)if(s)a[f][i]=0;else{n=c.$1ew({x:f,y:i});var u=n.x-o,v=n.x+o,w=n.y-p,x=n.y+p;m=[u,w,u,x,v,x,v,w],c.$1bw(l,m)&&(a[f][i]=0)}}},e.prototype.$1dw=function(a,b){var c=this,d=c.$16x,e=(a.x-d.x)/d.gridX,f=(a.y-d.y)/d.gridY;return b!==!1&&(e=Math.round(e),f=Math.round(f)),{x:e,y:f}},e.prototype.$1ew=function(a){var b=this,c=b.$16x;return{x:a.x*c.gridX+c.x,y:a.y*c.gridY+c.y}},e.prototype.$1fw=function(a){var b=this,c=b.$16x,d=c.xLen,e=c.yLen;if(a.x>=0&&a.x<d&&a.y>=0&&a.y<e)return a;var f={x:a.x,y:a.y};return f.x<0?f.x=0:f.x>=d&&(f.x=d-1),f.y<0?f.y=0:f.y>=e&&(f.y=e-1),f},e.prototype.findPath=function(a,b){var c,d,e,f,g=this,h=g.$1dw(a),i=g.$1dw(b);if(e=g.$1fw(h),f=g.$1fw(i),e!==h&&f!==i){var j=g.$16x,k=j.x-j.gridX/2,l=j.y-j.gridY/2,m=k+j.gridX*j.xLen,n=l+j.gridY*j.yLen;if(!(g.$18x(a.x,a.y,b.x,b.y,k,l,m,l)||g.$18x(a.x,a.y,b.x,b.y,m,l,m,n)||g.$18x(a.x,a.y,b.x,b.y,m,n,k,n)||g.$18x(a.x,a.y,b.x,b.y,k,n,k,l)))return[a,b]}e!==h&&(c=!0,h=e),f!==i&&(d=!0,i=f);var o=g.graph.grid[h.x][h.y],p=g.graph.grid[i.x][i.y],q=AStar.search(g.graph,o,p,{closest:g.$14x.closest,punish:g.$14x.turnPunish});if(!q||!q.length)return null;var r=[];r.push(a),c&&r.push(g.$1ew(q[0]));for(var s=1,t=q.length;t-1>s;s++)r.push(g.$1ew(q[s]));if(d)r.push(g.$1ew(q[t-1])),r.push(b);else{var u=q[t-1];i.x!==u.x||i.y!==u.y||g.$14x.toGridCenter?r.push(g.$1ew(u)):r.push(b)}return g.$14x.simplify&&(r=g.simplifyPath(r)),g.$20x=r,g.$21x(),r},e.prototype.debugOn=function(a){this.debugFlag=!0,this.debugSettings=a||{},this.$21x()},e.prototype.simplifyPath=function(a){var b=a.length;if(2>=b)return a;var c,d,e=[a[0],a[1]],f=e[0],g=e[1],h=1e-5;for(c=2;b>c;c++)d=a[c],Math.abs((g.x-f.x)*(d.y-f.y)-(g.y-f.y)*(d.x-f.x))<h?g=e[e.length-1]=d:(f=g,g=d,e.push(d));return e},e.prototype.$21x=function(){var a=this;if(a.$22x(),this.debugFlag){var b=a.grid;if(b){var c,e=a.gv;if(a.debugSettings.$16x!==!1){c=[];for(var f,g,h,i,j,k=[],l=a.$14x.gridSizeX/2,m=a.$14x.gridSizeY/2,n=b.length,o=n?b[0].length:0,p=1;n-1>p;p++)for(var q=1;o-1>q;q++)b[p][q]||(f=a.$1ew({x:p,y:q}),g=f.x-l,h=f.x+l,i=f.y-m,j=f.y+m,c.push({x:g,y:i},{x:g,y:j},{x:h,y:j},{x:h,y:i}),k.push(1,2,2,2,5));var r=new d.Shape;r.s("shape.border.color","rgba(50, 50, 50, 0.2)"),r.s("shape.border.width",1),r.s("shape.background","rgba(200, 50, 100, 0.2)"),r.s("2d.editable",!1),r.s("2d.selectable",!1),r.setPoints(c),r.setSegments(k),a._debugInfo={grid:r},e.dm().add(r)}a.debugSettings.path!==!1&&(c=new d.Shape,a.$20x&&(c.setPoints(a.$20x),c.s("shape.border.color","red"),c.s("shape.border.width",1),c.s("2d.editable",!1),c.s("2d.selectable",!1),c.s("shape.background",null),a._debugInfo||(a._debugInfo={}),a._debugInfo.path=c,e.dm().add(c)))}}},e.prototype.debugOff=function(){this.debugFlag=!1,this.$22x()},e.prototype.$22x=function(){var a=this;if(a._debugInfo){var b=a._debugInfo.grid,c=a._debugInfo.path,d=a.gv;b&&d.dm().remove(b),c&&d.dm().remove(c),a._debugInfo=null}}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);