!function(a,b,c){"use strict";var d=a.ht,e=d.Default,f=e.getInternal(),g=f.ui(),h=null,i="__segmentLengths",j="__lineTotalLength",k="__linePoints",l="__distance0",m="flow.count",n="flow.step",o="flow.element.max",p="flow.element.count",q="flow.element.min",r="flow.element.space",s="flow.element.autorotate",t="flow.element.background",u="flow.element.shadow.max",v="flow.element.shadow.min",w="flow.element.shadow.begincolor",x="flow.element.shadow.endcolor",y="flow.element.shadow.visible",z="flow.element.image",A="flow",B=d.Math.Vector2,C=new B,D=(new B,new B,d.List,d.Default._edgeProtectMethod),E=D.getStraightLinePoints,F=function(a,b){for(var c=[],d=a.length,e=0;d>e;e++){var f=a[e];f._as&&(f=f._as);for(var g=f[0],h=1;h<f.length;h++)c.push([g,f[h]]),g=f[h]}for(var i=[],e=0;e<c.length;e++){var j=H(c[e][0],c[e][1],b);i.push(j)}return{distance:i,segments:c}},G=function(a,b,c){if(a){for(var d,f=F(a,b),g=f.distance,h=f.segments,i=1/0,j=null,k=0,l=g.length;l>k;k++){var m=g[k];m.z<i&&(d=k,i=m.z,j=m)}if(null==c&&(c=.1),j.z<c){for(var n=0,o=0;d>=o;o++)n+=e.getDistance(h[o][0],d>o?h[o][1]:j);return n}}},H=function(a,b,c){var d=a.x,e=a.y,f=b.x,g=b.y,h=c.x,i=c.y,j=f-d,k=g-e,l=Math.sqrt(j*j+k*k),m=j/l,n=k/l,o=(-d+h)*m+(-e+i)*n,p={x:d+o*m,y:e+o*n};return p.x>=Math.min(a.x,b.x)&&p.x<=Math.max(a.x,b.x)&&p.y>=Math.min(a.y,b.y)&&p.y<=Math.max(a.y,b.y)||(p.x=Math.abs(p.x-a.x)<Math.abs(p.x-b.x)?a.x:b.x,p.y=Math.abs(p.y-a.y)<Math.abs(p.y-b.y)?a.y:b.y),j=h-p.x,k=i-p.y,p.z=Math.sqrt(j*j+k*k),p},I=function(a,b){if(a){var c=F(a,b).distance,d=1/0,e=null;return c.forEach(function(a){a.z<d&&(d=a.z,e=a)}),e}},J=D.calculateLineLength,K=D.calcSegmentIndexByDistance,L=D.calculatePointAlongLine,M=function(a,b,c){if(!a)return c;if(0===b){var d=a[0][0],e=a[0][1];return c+Math.atan2(e.y-d.y,e.x-d.x)}if(100===b){a=a[a.length-1];var d=a[a.length-2],e=a[a.length-1];return c+Math.atan2(e.y-d.y,e.x-d.x)}for(var f=0,g=[],h=a.length,i=0;h>i;i++){var j=a[i],k=J(j);f+=k,g.push(k)}for(var l=f*b/100,m=K(l,g),n=0,o=0;m>o;o++)n+=g[o];l-=n;for(var p=L(a[m],l),q=a[m],r=0,s=0,t=0;t<q.length-1;t++){var u=q[t],v=q[t+1],w=v.x-u.x,x=v.y-u.y,y=Math.sqrt(w*w+x*x);if(r+=y,r>l){s=t;break}}var z=q[s];return c+Math.atan2(p.y-z.y,p.x-z.x)},N=function(a){var b=0;if(a)if(Array.isArray(a[0]))for(var c=a.length,d=0;c>d;d++){var e=a[d],f=J(e);b+=f}else b=J(a);return b},O=function(a,b,c,d){return C.set(b,c).rotateAround(null,d),a?{x:a.x+C.x,y:a.y+C.y}:{x:C.x,y:C.y}},P=function(a){var b=a._data,c=E(a);if(c){b.s("flow.reverse")&&(c.reverse(),c.forEach(function(a){a.reverse()}));for(var f=0,g=[],h=c.length,l=0;h>l;l++){var m=c[l],n=J(m);f+=n,g.push(n)}if(b[i]=g,b[j]=f,b[k]=c,b instanceof d.Edge){var o=e.unionPoint(c),p=o.x+o.width/2,q=o.y+o.height/2;b.$10e={x:p,y:q}}R(a,!0)}},Q=D.getPercentPosition,R=function(a,b){var c=a._data,d=c[j],e=c.s(m),f=c.s(n),g=0,h=c[i],k=c.s(o),r=c.s(q),s=c.s(p),t=(k-r)/(s-1),u=[];if(h){if(1===s)u.push(k);else if(2===s)u.push(k),u.push(r);else{if(!(s>2))return;u.push(k);for(var v=s-2;v>0;v--)u.push(r+t*v);u.push(r)}var w=0,x=0;u.forEach(function(a){s-1>w&&(x+=c.getFlowElementSpace(a)),w++}),x+=(k+r)/2,g=(d-e*x+x)/e;var y=a[l];for(null==y&&(y=0),b||(y+=f);y>d+x;){var z=a._overCount;z?z++:z=1,z>=e&&(z=null),a._overCount=z,c.s("flow.autoreverse")?z?y-=g+x:(y=0,c.s("flow.reverse",!c.s("flow.reverse"))):y-=g+x}a[l]=y}},S="prototype",T=d.graph.GraphView[S],U=d.Data[S],V=g.DataUI[S],W=g.ShapeUI[S],X=g.EdgeUI[S],Y=d.DataModel[S],Z=d.Style;Z[o]==h&&(Z[o]=7),Z[q]==h&&(Z[q]=0),Z[m]==h&&(Z[m]=1),Z[n]==h&&(Z[n]=3),Z[p]==h&&(Z[p]=10),Z[r]==h&&(Z[r]=3.5),Z[s]==h&&(Z[s]=!1),Z[t]==h&&(Z[t]="rgba(255, 255, 114, 0.4)"),Z[w]==h&&(Z[w]="rgba(255, 255, 0, 0.3)"),Z[x]==h&&(Z[x]="rgba(255, 255, 0, 0)"),Z[y]==h&&(Z[y]=1),Z[u]==h&&(Z[u]=22),Z[v]==h&&(Z[v]=4),T.calculatePointLength=function(a,b,c){var d=this.getDataUI(a),e=E(d);return G(e,b,c)},e.calculatePointLength=function(a,b,c,d){var e=E(h,a,b);return G(e,c,d)},e.calculateClosestPointOnLine=H,T.calculateClosestPoint=function(a,b){var c=this.getDataUI(a),d=E(c);return I(d,b)},e.calculateClosestPoint=function(a,b,c){var d=E(h,a,b);return I(d,c)},T.getPercentAngle=function(a,b){var c=this.getDataUI(a),d=E(c);a.getRotation?a.getRotation():0;return M(d,b,a.getRotation?a.getRotation():0)},e.getPercentAngle=function(a,b,c){var d=E(h,a,b);return M(d,c,0)},T.calculateLength=function(a){var b=this.getDataUI(a),c=E(b);return N(c)},e.calculateLength=function(a,b){var c=E(h,a,b);return N(c)},T.getPercentPosition=function(a,b){var c=this.getDataUI(a),d=E(c);return Q(d,b)},e.getPercentPositionOnPoints=function(a,b,c){var d=E(h,a,b);return Q(d,c)};var $=function(a){var b=a.data,c=this.dm();if(b&&"add"===a.kind){var d=c.$3e;d&&b.s(A)&&d.indexOf(b)<0&&d.push(b)}"clear"===a.kind&&(c.$3e=[])},_=function(a){var b=a.property,c=a.data,d=a.newValue,e=this.dm().$3e;if(e&&"s:flow"===b)if(d)e.indexOf(c)<0&&e.push(c);else for(var f=e.length,g=0;f>g;g++)if(e[g]===c){e.splice(g,1);break}},aa=T.setDataModel;T.setDataModel=function(a){var b=this,c=b._dataModel;if(c!==a){c&&(c.umm($,b),c.umd(_,b),c.$3e=[]),a.mm($,b),a.md(_,b);var d=a.$3e=[];a.each(function(a){a.s(A)&&d.indexOf(a)<0&&d.push(a)}),aa.call(b,a)}},U.getFlowElementSpace=function(a){return this.s(r)};var ba=function(a){var b=this,c=b._data,d=c[j],e=c[i],f=c[k],g=c.s(m),n=0,r=b[l],t=c.s(o),w=c.s(q),x=c.s(p),y=c.s(v),z=c.s(u),A=c.s(s),B=(z-y)/(x-1),C=(t-w)/(x-1),D=c.getRotation?c.getRotation():0,E=c.getPosition?c.p():c.$10e,F=[],G=[];if(r!=h){if(1===x)F.push(t);else if(2===x)F.push(t),F.push(w);else{if(!(x>2))return;F.push(t);for(var H=x-2;H>0;H--)F.push(w+C*H);F.push(w)}if(1===x)G.push(z);else if(2===x)G.push(z),G.push(y);else{if(!(x>2))return;G.push(z);for(var H=x-2;H>0;H--)G.push(y+B*H);G.push(y)}var I=0,J=0;F.forEach(function(a){x-1>I&&(J+=c.getFlowElementSpace(a)),I++}),J+=(t+w)/2,n=(d-g*J+J)/g,a.save();for(var H=0;g>H;H++){var M=r,N=0,P=b._overCount,Q=0;c.s("flow.autoreverse")&&P&&P>g-(H+1)||(M-=H*(n+J),I=0,F.forEach(function(g){var h=M-N;if(h>=0&&d>h){var i=!0,j=K(h,e);Q=0;for(var k=0;j>k;k++)Q+=e[k];if(h-=Q,i){var l=L(f[j],h),m=D;if(A){for(var n=f[j],o=0,p=0,q=0;q<n.length-1;q++){var r=n[q],s=n[q+1],t=s.x-r.x,u=s.y-r.y,v=Math.sqrt(t*t+u*u);if(o+=v,o>h){p=q;break}}var w=n[p];m+=Math.atan2(l.y-w.y,l.x-w.x)}D&&(l=O(E,l.x-E.x,l.y-E.y,D)),b.$5e(a,l,g,G[I],m)}}N+=c.getFlowElementSpace(F[I]),I++}))}a.restore()}},ca=X._80o;X._80o=function(a){ca.call(this,a);var b=this,c=b._data,d=b.gv;c.s(A)&&d.$7e!=h&&ba.call(b,a)};var da=W._80o;W._80o=function(a){da.call(this,a);var b=this,c=b._data,d=b.gv;c.s(A)&&d.$7e!=h&&ba.call(b,a)};var ea=X._79o,fa=W._79o,ga=function(){var a=this,b=a._data,c=b.s(o),f=!1,g=h;if(a._6I||(f=!0),g=b instanceof d.Edge?ea.call(a):fa.call(a),b.s(A)&&f){var m=b.s(u),n=b.s(y);n&&m>c&&(c=m),c>0&&e.grow(g,Math.ceil(c/2)),P(a)}return!b.s(A)&&f&&(b[i]=b[j]=b[k]=a[l]=h),g};W._79o=ga,X._79o=ga,V.$5e=function(a,b,c,d,g){var i=this,j=i._data,k=i.gv,l=j.s(t),m=j.s(w),n=j.s(x),o=j.s(y),p=k.$8e,q=j.s(z);if(p==h&&(p=k.$8e={}),a.beginPath(),q!=h){var r=e.getImage(q),s=c/2;a.translate(b.x,b.y),a.rotate(g),a.translate(-b.x,-b.y),e.drawImage(a,r,b.x-s,b.y-s,c,c,j),a.translate(b.x,b.y),a.rotate(-g),a.translate(-b.x,-b.y)}else if(k.__flowBatch){var u=k.__flowBatchGroup;u||(u=k.__flowBatchGroup={});var v=[b.x,b.y,c/2];u[l]?u[l].push(v):u[l]=[v]}else a.fillStyle=l,a.arc(b.x,b.y,c/2,0,2*Math.PI,!0),a.fill();if(o){var A=22,B=A+"_"+m+"_"+n,C=p[B];if(C==h){var D=document.createElement("canvas");f.setCanvas(D,A,A);var E=D.getContext("2d"),F=A/2,G=F,H=F;f.translateAndScale(E,0,0,1),E.beginPath();var I=E.createRadialGradient(G,H,0,G,G,F);I.addColorStop(0,m),I.addColorStop(1,n),E.fillStyle=I,E.arc(G,H,F,0,2*Math.PI,!0),E.fill(),C=p[B]=D}var s=d/2;e.drawImage(a,C,b.x-s,b.y-s,d,d,j)}},T.$9e=function(){var a=this,b=a.dm().$3e;a._24I;b.forEach(function(b){a._24I[b._id]=b}),a.iv()};var ha=Y.prepareRemove;Y.prepareRemove=function(a){ha.call(this,a);var b=a._dataModel,c=b.$3e;if(c)for(var d=c.length,e=0;d>e;e++)if(c[e]===a){c.splice(e,1);break}},T.setFlowInterval=function(a){var b=this,c=b.$11e;b.$11e=a,b.fp("flowInterval",c,a),b.$7e!=h&&(clearInterval(b.$7e),delete b.$7e,b.enableFlow(a))},T.getFlowInterval=function(){return this.$11e},T.enableFlow=function(a){var b=this,c=b.dm(),d=c.$3e;b.$7e==h&&(d.forEach(function(a){var c=b.getDataUI(a);P(c)}),b.$7e=setInterval(function(){c.$3e.forEach(function(a){R(b.getDataUI(a))}),b.$9e()},a||b.$11e||50))},T.disableFlow=function(){var a=this;clearInterval(a.$7e),delete a.$7e;var b=a.dm().$3e;b&&a.$9e()};var ia=function(a){this.__flowBatchGroup={}},ja=function(a){var b=this.__flowBatchGroup;if(b){a.save();for(var c in b){a.fillStyle=c,a.beginPath();var d=b[c];d.forEach(function(b){a.moveTo(b[0],b[1]),a.arc(b[0],b[1],b[2],0,2*Math.PI,!0)}),a.fill()}a.restore()}};T.setFlowBatch=function(a){var b=this;!!b.__flowBatch!=!!a&&(b.__flowBatch=a,a?(b.addBottomPainter(ia),b.addTopPainter(ja)):(b.removeBottomPainter(ia),b.removeTopPainter(ja)))}}("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:(0,eval)("this"),Object);